<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent-MCP系统关键代码实现详解</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: rgba(255,255,255,0.95);
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
        }
        
        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #3498db, #9b59b6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .section {
            background: rgba(255,255,255,0.95);
            margin-bottom: 30px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .section-header {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            padding: 20px;
            font-size: 1.5em;
            font-weight: bold;
            display: flex;
            align-items: center;
        }
        
        .section-header .icon {
            margin-right: 15px;
            font-size: 1.2em;
        }
        
        .section-content {
            padding: 25px;
        }
        
        .code-section {
            background: #2d3748;
            border-radius: 10px;
            margin: 20px 0;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .code-header {
            background: #4a5568;
            color: white;
            padding: 15px 20px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .file-path {
            background: #e74c3c;
            color: white;
            padding: 3px 8px;
            border-radius: 5px;
            font-size: 0.8em;
            font-family: monospace;
        }
        
        .code-content {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            overflow-x: auto;
            font-family: 'Courier New', Monaco, monospace;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .line-number {
            color: #a0aec0;
            margin-right: 15px;
            user-select: none;
        }
        
        .keyword {
            color: #9f7efe;
            font-weight: bold;
        }
        
        .string {
            color: #68d391;
        }
        
        .comment {
            color: #a0aec0;
            font-style: italic;
        }
        
        .function {
            color: #fbb6ce;
        }
        
        .variable {
            color: #90cdf4;
        }
        
        .highlight-line {
            background: rgba(255, 255, 0, 0.1);
            border-left: 3px solid #ffd700;
            padding-left: 17px;
            margin-left: -20px;
        }
        
        .flow-diagram {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin: 20px 0;
        }
        
        .flow-step {
            display: flex;
            align-items: center;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .flow-step::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .flow-step:hover::before {
            left: 100%;
        }
        
        .step-number {
            background: rgba(255,255,255,0.2);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 20px;
            flex-shrink: 0;
        }
        
        .step-content {
            flex: 1;
        }
        
        .step-title {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 1.1em;
        }
        
        .step-description {
            opacity: 0.9;
            font-size: 0.95em;
        }
        
        .mechanism-card {
            background: white;
            border-radius: 10px;
            padding: 25px;
            margin: 20px 0;
            border-left: 5px solid #3498db;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        
        .mechanism-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
        
        .mechanism-title {
            color: #2c3e50;
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        
        .mechanism-title .icon {
            margin-right: 10px;
            font-size: 1.2em;
            color: #3498db;
        }
        
        .code-explanation {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #28a745;
        }
        
        .explanation-title {
            font-weight: bold;
            color: #28a745;
            margin-bottom: 10px;
        }
        
        .table-container {
            overflow-x: auto;
            margin: 20px 0;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }
        
        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #ecf0f1;
        }
        
        th {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            font-weight: bold;
        }
        
        tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        tr:hover {
            background: #e3f2fd;
        }
        
        .priority-badge {
            background: #3498db;
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
        }
        
        .priority-1 { background: #e74c3c; }
        .priority-2 { background: #f39c12; }
        .priority-3 { background: #f1c40f; }
        .priority-4 { background: #27ae60; }
        .priority-5 { background: #3498db; }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
            
            .code-content {
                font-size: 12px;
            }
            
            .flow-step {
                flex-direction: column;
                text-align: center;
            }
            
            .step-number {
                margin-bottom: 10px;
                margin-right: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 头部 -->
        <div class="header">
            <h1>🔍 Agent-MCP系统关键代码实现详解</h1>
            <p>深入分析每个关键机制的具体源码实现</p>
        </div>

        <!-- LLM分析与执行计划生成 -->
        <div class="section">
            <div class="section-header">
                <span class="icon">🧠</span>
                LLM分析用户查询 → 选择合适功能 → 按优先级排序 → 生成执行计划
            </div>
            <div class="section-content">
                <div class="mechanism-card">
                    <div class="mechanism-title">
                        <span class="icon">📋</span>
                        实现文件：agent/core.py - process_query方法
                    </div>
                    
                    <div class="code-section">
                        <div class="code-header">
                            <span>核心流程代码</span>
                            <span class="file-path">agent/core.py</span>
                        </div>
                        <div class="code-content">
<span class="line-number">34</span><span class="keyword">async def</span> <span class="function">process_query</span>(<span class="variable">self</span>, <span class="variable">query</span>: <span class="keyword">str</span>) -> Dict[<span class="keyword">str</span>, Any]:
<span class="line-number">35</span>    <span class="comment"># 步骤1: 接收用户查询</span>
<span class="line-number">36</span>    logger.info(<span class="string">f"🎯 Agent接收到用户查询: {query}"</span>)
<span class="line-number">37</span>    
<span class="line-number">38</span>    <span class="comment"># 步骤2: 获取MCP服务器可用功能列表</span>
<span class="line-number">39</span><span class="highlight-line">    <span class="variable">available_functions</span> = <span class="variable">self</span>.<span class="variable">mcp_server</span>.<span class="function">get_available_functions</span>()</span>
<span class="line-number">40</span>    logger.info(<span class="string">f"📦 获取到 {len(available_functions)} 个可用功能"</span>)
<span class="line-number">41</span>    
<span class="line-number">42</span>    <span class="comment"># 步骤3: 调用大模型进行任务分析和执行计划生成</span>
<span class="line-number">43</span><span class="highlight-line">    <span class="variable">task_analysis</span> = <span class="keyword">await</span> <span class="variable">self</span>.<span class="variable">llm_client</span>.<span class="function">analyze_task</span>(<span class="variable">query</span>, <span class="variable">available_functions</span>)</span>
<span class="line-number">44</span>    
<span class="line-number">45</span>    <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable">task_analysis</span>.<span class="function">get</span>(<span class="string">"steps"</span>):
<span class="line-number">46</span>        <span class="keyword">return</span> {<span class="string">"success"</span>: <span class="keyword">False</span>, <span class="string">"message"</span>: <span class="string">"大模型无法生成执行计划"</span>}
<span class="line-number">47</span>    
<span class="line-number">48</span>    <span class="variable">steps</span> = <span class="variable">task_analysis</span>[<span class="string">"steps"</span>]  <span class="comment"># 获取按优先级排序的执行步骤</span>
<span class="line-number">49</span>    <span class="variable">reasoning</span> = <span class="variable">task_analysis</span>.<span class="function">get</span>(<span class="string">"reasoning"</span>, <span class="string">""</span>)
<span class="line-number">50</span>    
<span class="line-number">51</span>    <span class="comment"># 步骤4: 执行任务计划</span>
<span class="line-number">52</span><span class="highlight-line">    <span class="variable">results</span> = <span class="keyword">await</span> <span class="variable">self</span>.<span class="variable">executor</span>.<span class="function">execute_with_llm_guidance</span>(<span class="variable">query</span>, <span class="variable">steps</span>)</span>
                        </div>
                    </div>
                    
                    <div class="code-explanation">
                        <div class="explanation-title">🔍 代码逻辑解析</div>
                        <p><strong>第39行：</strong>从MCP服务器获取所有可用功能及其优先级信息</p>
                        <p><strong>第43行：</strong>将用户查询和功能列表发送给LLM进行智能分析</p>
                        <p><strong>第52行：</strong>将LLM生成的执行计划传递给任务执行器</p>
                    </div>
                </div>

                <div class="mechanism-card">
                    <div class="mechanism-title">
                        <span class="icon">🎯</span>
                        LLM任务分析实现：llm_client.py - analyze_task方法
                    </div>
                    
                    <div class="code-section">
                        <div class="code-header">
                            <span>LLM分析与优先级排序</span>
                            <span class="file-path">agent/llm_client.py</span>
                        </div>
                        <div class="code-content">
<span class="line-number">95</span><span class="keyword">async def</span> <span class="function">analyze_task</span>(<span class="variable">self</span>, <span class="variable">query</span>: <span class="keyword">str</span>, <span class="variable">available_functions</span>: List[Dict]) -> Dict[<span class="keyword">str</span>, Any]:
<span class="line-number">96</span>    <span class="comment"># 构建功能信息，包含优先级</span>
<span class="line-number">97</span><span class="highlight-line">    <span class="variable">functions_info</span> = <span class="string">"\n"</span>.<span class="function">join</span>([</span>
<span class="line-number">98</span><span class="highlight-line">        <span class="string">f"- {func['name']}: {func['description']} (优先级: {func['priority']}, 类别: {func['category']})"</span></span>
<span class="line-number">99</span><span class="highlight-line">        <span class="keyword">for</span> <span class="variable">func</span> <span class="keyword">in</span> <span class="variable">available_functions</span></span>
<span class="line-number">100</span><span class="highlight-line">    ])</span>
<span class="line-number">101</span>    
<span class="line-number">102</span>    <span class="comment"># 构建提示词，指导LLM按优先级选择功能</span>
<span class="line-number">103</span>    <span class="variable">prompt</span> = <span class="string">f"""
<span class="line-number">104</span>你是一个智能任务分析助手。根据用户查询，从可用功能中选择合适的功能，并生成执行计划。
<span class="line-number">105</span>
<span class="line-number">106</span>可用功能:
<span class="line-number">107</span>{functions_info}
<span class="line-number">108</span>
<span class="line-number">109</span>用户查询: {query}
<span class="line-number">110</span>
<span class="line-number">111</span>请分析用户查询，选择合适的功能，并按逻辑顺序排列。
<span class="line-number">112</span>
<span class="line-number">113</span>注意：
<span class="line-number">114</span><span class="highlight-line">1. 优先选择优先级低的功能（数字越小优先级越高）</span>
<span class="line-number">115</span><span class="highlight-line">2. 按照逻辑顺序排列功能：验证->查询/读取->处理->分析->写入/发送</span>
<span class="line-number">116</span>3. 根据查询内容智能匹配参数
<span class="line-number">117</span>"""</span>
<span class="line-number">118</span>    
<span class="line-number">119</span>    <span class="variable">messages</span> = [{<span class="string">"role"</span>: <span class="string">"user"</span>, <span class="string">"content"</span>: <span class="variable">prompt</span>}]
<span class="line-number">120</span><span class="highlight-line">    <span class="variable">response</span> = <span class="keyword">await</span> <span class="variable">self</span>.<span class="function">chat_completion</span>(<span class="variable">messages</span>)</span>
<span class="line-number">121</span>    
<span class="line-number">122</span>    <span class="keyword">try</span>:
<span class="line-number">123</span><span class="highlight-line">        <span class="variable">result</span> = json.<span class="function">loads</span>(<span class="variable">response</span>)  <span class="comment"># 解析LLM返回的JSON格式执行计划</span></span>
<span class="line-number">124</span>        <span class="keyword">return</span> <span class="variable">result</span>
<span class="line-number">125</span>    <span class="keyword">except</span> Exception <span class="keyword">as</span> <span class="variable">e</span>:
<span class="line-number">126</span>        <span class="keyword">return</span> {<span class="string">"steps"</span>: [], <span class="string">"reasoning"</span>: <span class="string">"解析失败"</span>}
                        </div>
                    </div>
                    
                    <div class="code-explanation">
                        <div class="explanation-title">🔍 优先级排序机制</div>
                        <p><strong>第97-100行：</strong>将所有功能及其优先级信息格式化为提示词</p>
                        <p><strong>第114-115行：</strong>明确指示LLM按优先级和逻辑顺序排列功能</p>
                        <p><strong>第123行：</strong>解析LLM返回的JSON格式执行计划</p>
                    </div>
                </div>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>优先级</th>
                                <th>功能类别</th>
                                <th>典型功能</th>
                                <th>执行逻辑</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="priority-badge priority-1">1</span></td>
                                <td>数据验证</td>
                                <td>validate_data</td>
                                <td>首先验证输入数据的完整性和正确性</td>
                            </tr>
                            <tr>
                                <td><span class="priority-badge priority-2">2</span></td>
                                <td>查询/读取</td>
                                <td>database_query, read_file</td>
                                <td>获取需要处理的数据源</td>
                            </tr>
                            <tr>
                                <td><span class="priority-badge priority-3">3</span></td>
                                <td>数据处理</td>
                                <td>process_data, http_request</td>
                                <td>对数据进行转换、格式化等处理</td>
                            </tr>
                            <tr>
                                <td><span class="priority-badge priority-4">4</span></td>
                                <td>数据分析</td>
                                <td>analyze_data</td>
                                <td>对处理后的数据进行深度分析</td>
                            </tr>
                            <tr>
                                <td><span class="priority-badge priority-5">5+</span></td>
                                <td>写入/通信</td>
                                <td>write_file, send_email, database_insert</td>
                                <td>将结果保存或发送给外部系统</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- FIFO队列机制 -->
        <div class="section">
            <div class="section-header">
                <span class="icon">📋</span>
                FIFO队列机制 - 如何确保步骤顺序执行
            </div>
            <div class="section-content">
                <div class="mechanism-card">
                    <div class="mechanism-title">
                        <span class="icon">⚡</span>
                        实现文件：agent/executor.py - execute_with_llm_guidance方法
                    </div>
                    
                    <div class="code-section">
                        <div class="code-header">
                            <span>FIFO队列顺序执行机制</span>
                            <span class="file-path">agent/executor.py</span>
                        </div>
                        <div class="code-content">
<span class="line-number">15</span><span class="keyword">async def</span> <span class="function">execute_with_llm_guidance</span>(<span class="variable">self</span>, <span class="variable">query</span>: <span class="keyword">str</span>, <span class="variable">steps</span>: List[Dict[<span class="keyword">str</span>, Any]]) -> List[Dict[<span class="keyword">str</span>, Any]]:
<span class="line-number">16</span>    <span class="variable">results</span> = []  <span class="comment"># 存储所有步骤执行结果</span>
<span class="line-number">17</span><span class="highlight-line">    <span class="variable">remaining_steps</span> = <span class="variable">steps</span>.<span class="function">copy</span>()  <span class="comment"># 复制步骤列表，形成FIFO队列</span></span>
<span class="line-number">18</span>    
<span class="line-number">19</span>    <span class="variable">step_counter</span> = 1
<span class="line-number">20</span><span class="highlight-line">    <span class="keyword">while</span> <span class="variable">remaining_steps</span>:  <span class="comment"># 关键：循环直到队列为空</span></span>
<span class="line-number">21</span><span class="highlight-line">        <span class="variable">current_step</span> = <span class="variable">remaining_steps</span>[0]  <span class="comment"># 总是执行队列第一个元素</span></span>
<span class="line-number">22</span>        
<span class="line-number">23</span>        logger.info(<span class="string">f"📍 执行步骤 {step_counter}: {current_step['function_name']}"</span>)
<span class="line-number">24</span>        
<span class="line-number">25</span>        <span class="comment"># 执行当前步骤</span>
<span class="line-number">26</span>        <span class="variable">start_time</span> = time.<span class="function">time</span>()
<span class="line-number">27</span><span class="highlight-line">        <span class="variable">result</span> = <span class="keyword">await</span> <span class="variable">self</span>.<span class="variable">mcp_server</span>.<span class="function">execute_function</span>(</span>
<span class="line-number">28</span><span class="highlight-line">            <span class="variable">current_step</span>[<span class="string">'function_name'</span>],</span>
<span class="line-number">29</span><span class="highlight-line">            **<span class="variable">current_step</span>[<span class="string">'parameters'</span>]</span>
<span class="line-number">30</span><span class="highlight-line">        )</span>
<span class="line-number">31</span>        <span class="variable">end_time</span> = time.<span class="function">time</span>()
<span class="line-number">32</span>        
<span class="line-number">33</span>        <span class="comment"># 记录步骤执行结果</span>
<span class="line-number">34</span><span class="highlight-line">        <span class="variable">step_result</span> = {</span>
<span class="line-number">35</span><span class="highlight-line">            <span class="string">"step"</span>: <span class="variable">step_counter</span>,</span>
<span class="line-number">36</span><span class="highlight-line">            <span class="string">"function_name"</span>: <span class="variable">current_step</span>[<span class="string">'function_name'</span>],</span>
<span class="line-number">37</span><span class="highlight-line">            <span class="string">"parameters"</span>: <span class="variable">current_step</span>[<span class="string">'parameters'</span>],</span>
<span class="line-number">38</span><span class="highlight-line">            <span class="string">"result"</span>: <span class="variable">result</span>,</span>
<span class="line-number">39</span><span class="highlight-line">            <span class="string">"execution_time"</span>: <span class="variable">end_time</span> - <span class="variable">start_time</span></span>
<span class="line-number">40</span><span class="highlight-line">        }</span>
<span class="line-number">41</span><span class="highlight-line">        <span class="variable">results</span>.<span class="function">append</span>(<span class="variable">step_result</span>)  <span class="comment"># 记录执行结果</span></span>
<span class="line-number">42</span><span class="highlight-line">        <span class="variable">remaining_steps</span>.<span class="function">pop</span>(0)  <span class="comment"># 从队列移除已完成步骤</span></span>
<span class="line-number">43</span>        
<span class="line-number">44</span>        <span class="keyword">if</span> <span class="variable">remaining_steps</span>:  <span class="comment"># 如果还有剩余步骤</span>
<span class="line-number">45</span>            <span class="comment"># 咨询LLM决定下一步</span>
<span class="line-number">46</span><span class="highlight-line">            <span class="variable">decision</span> = <span class="keyword">await</span> <span class="variable">self</span>.<span class="variable">llm_client</span>.<span class="function">decide_next_step</span>(<span class="variable">query</span>, <span class="variable">results</span>, <span class="variable">remaining_steps</span>)</span>
<span class="line-number">47</span>            
<span class="line-number">48</span>            <span class="variable">action</span> = <span class="variable">decision</span>.<span class="function">get</span>(<span class="string">"action"</span>, <span class="string">"continue"</span>)
<span class="line-number">49</span>            <span class="keyword">if</span> <span class="variable">action</span> == <span class="string">"stop"</span>:
<span class="line-number">50</span>                <span class="keyword">break</span>
<span class="line-number">51</span>            <span class="keyword">elif</span> <span class="variable">action</span> == <span class="string">"modify"</span> <span class="keyword">and</span> <span class="variable">decision</span>.<span class="function">get</span>(<span class="string">"next_step"</span>):
<span class="line-number">52</span><span class="highlight-line">                <span class="variable">remaining_steps</span>[0] = <span class="variable">decision</span>[<span class="string">"next_step"</span>]  <span class="comment"># 修改队列第一个元素</span></span>
<span class="line-number">53</span>        
<span class="line-number">54</span>        <span class="variable">step_counter</span> += 1
<span class="line-number">55</span>    
<span class="line-number">56</span><span class="highlight-line">    <span class="keyword">return</span> <span class="variable">results</span>  <span class="comment"># 返回所有步骤执行结果</span></span>
                        </div>
                    </div>
                    
                    <div class="code-explanation">
                        <div class="explanation-title">🔍 FIFO队列机制解析</div>
                        <p><strong>第17行：</strong>复制步骤列表形成FIFO队列，保持原始计划不变</p>
                        <p><strong>第20行：</strong>while循环确保所有步骤都被处理</p>
                        <p><strong>第21行：</strong>总是执行remaining_steps[0]，确保FIFO顺序</p>
                        <p><strong>第42行：</strong>执行完成后用pop(0)移除队列首元素</p>
                        <p><strong>第52行：</strong>如果需要修改，只修改队列下一个元素</p>
                    </div>
                </div>

                <div class="flow-diagram">
                    <div class="flow-step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <div class="step-title">初始化队列</div>
                            <div class="step-description">remaining_steps = [步骤1, 步骤2, 步骤3, 步骤4]</div>
                        </div>
                    </div>
                    
                    <div class="flow-step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <div class="step-title">执行队列首元素</div>
                            <div class="step-description">current_step = remaining_steps[0] → 执行步骤1</div>
                        </div>
                    </div>
                    
                    <div class="flow-step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <div class="step-title">移除已完成步骤</div>
                            <div class="step-description">remaining_steps.pop(0) → [步骤2, 步骤3, 步骤4]</div>
                        </div>
                    </div>
                    
                    <div class="flow-step">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <div class="step-title">循环继续</div>
                            <div class="step-description">重复过程，直到remaining_steps为空</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 步骤间通知机制 -->
        <div class="section">
            <div class="section-header">
                <span class="icon">🔄</span>
                步骤1完成后如何通知执行步骤2
            </div>
            <div class="section-content">
                <div class="mechanism-card">
                    <div class="mechanism-title">
                        <span class="icon">📝</span>
                        通过results.append()记录 + remaining_steps.pop(0)移除机制
                    </div>
                    
                    <div class="code-section">
                        <div class="code-header">
                            <span>步骤完成通知机制</span>
                            <span class="file-path">agent/executor.py</span>
                        </div>
                        <div class="code-content">
<span class="line-number">34</span>        <span class="comment"># 📝 步骤1：记录当前步骤执行结果</span>
<span class="line-number">35</span><span class="highlight-line">        <span class="variable">step_result</span> = {</span>
<span class="line-number">36</span><span class="highlight-line">            <span class="string">"step"</span>: <span class="variable">step_counter</span>,                    <span class="comment"># 步骤编号</span></span>
<span class="line-number">37</span><span class="highlight-line">            <span class="string">"function_name"</span>: <span class="variable">current_step</span>[<span class="string">'function_name'</span>], <span class="comment"># 执行的功能名</span></span>
<span class="line-number">38</span><span class="highlight-line">            <span class="string">"parameters"</span>: <span class="variable">current_step</span>[<span class="string">'parameters'</span>],     <span class="comment"># 执行参数</span></span>
<span class="line-number">39</span><span class="highlight-line">            <span class="string">"result"</span>: <span class="variable">result</span>,                        <span class="comment"># MCP执行结果</span></span>
<span class="line-number">40</span><span class="highlight-line">            <span class="string">"execution_time"</span>: <span class="variable">end_time</span> - <span class="variable">start_time</span>, <span class="comment"># 执行耗时</span></span>
<span class="line-number">41</span><span class="highlight-line">            <span class="string">"timestamp"</span>: time.<span class="function">time</span>()              <span class="comment"># 执行时间戳</span></span>
<span class="line-number">42</span><span class="highlight-line">        }</span>
<span class="line-number">43</span>        
<span class="line-number">44</span>        <span class="comment"># 📝 步骤2：将结果添加到results列表（完成通知）</span>
<span class="line-number">45</span><span class="highlight-line">        <span class="variable">results</span>.<span class="function">append</span>(<span class="variable">step_result</span>)  <span class="comment"># ✅ 标记步骤1已完成</span></span>
<span class="line-number">46</span>        
<span class="line-number">47</span>        <span class="comment"># 📝 步骤3：从待执行队列移除已完成步骤</span>
<span class="line-number">48</span><span class="highlight-line">        <span class="variable">remaining_steps</span>.<span class="function">pop</span>(0)  <span class="comment"># ✅ 步骤1出队，步骤2成为队首</span></span>
<span class="line-number">49</span>        
<span class="line-number">50</span>        <span class="comment"># 📝 步骤4：检查是否还有待执行步骤</span>
<span class="line-number">51</span>        <span class="keyword">if</span> <span class="variable">remaining_steps</span>:  <span class="comment"># 如果队列不为空</span>
<span class="line-number">52</span>            <span class="comment"># 📝 步骤5：咨询LLM关于下一步的决策</span>
<span class="line-number">53</span><span class="highlight-line">            <span class="variable">decision</span> = <span class="keyword">await</span> <span class="variable">self</span>.<span class="variable">llm_client</span>.<span class="function">decide_next_step</span>(</span>
<span class="line-number">54</span><span class="highlight-line">                <span class="variable">query</span>,           <span class="comment"># 原始用户查询</span></span>
<span class="line-number">55</span><span class="highlight-line">                <span class="variable">results</span>,         <span class="comment"># 已完成步骤的执行历史</span></span>
<span class="line-number">56</span><span class="highlight-line">                <span class="variable">remaining_steps</span>  <span class="comment"># 剩余待执行步骤</span></span>
<span class="line-number">57</span><span class="highlight-line">            )</span>
<span class="line-number">58</span>            
<span class="line-number">59</span>            <span class="comment"># 📝 步骤6：根据LLM决策调整执行计划</span>
<span class="line-number">60</span>            <span class="variable">action</span> = <span class="variable">decision</span>.<span class="function">get</span>(<span class="string">"action"</span>, <span class="string">"continue"</span>)
<span class="line-number">61</span>            <span class="keyword">if</span> <span class="variable">action</span> == <span class="string">"stop"</span>:
<span class="line-number">62</span>                <span class="keyword">break</span>  <span class="comment"># 停止执行</span>
<span class="line-number">63</span>            <span class="keyword">elif</span> <span class="variable">action</span> == <span class="string">"modify"</span>:
<span class="line-number">64</span><span class="highlight-line">                <span class="variable">remaining_steps</span>[0] = <span class="variable">decision</span>[<span class="string">"next_step"</span>]  <span class="comment"># 修改步骤2</span></span>
<span class="line-number">65</span>        
<span class="line-number">66</span>        <span class="comment"># 📝 步骤7：循环回到while开始，执行步骤2</span>
<span class="line-number">67</span>        <span class="variable">step_counter</span> += 1  <span class="comment"># 步骤计数器递增</span>
                        </div>
                    </div>
                    
                    <div class="code-explanation">
                        <div class="explanation-title">🔍 通知机制详解</div>
                        <p><strong>第45行：</strong>results.append()不是简单记录，而是"完成通知"机制</p>
                        <p><strong>第48行：</strong>remaining_steps.pop(0)移除已完成步骤，使步骤2成为队首</p>
                        <p><strong>第53-57行：</strong>LLM能访问完整的执行历史，做出智能决策</p>
                        <p><strong>循环特性：</strong>while循环自动回到第20行，执行新的队首元素</p>
                    </div>
                </div>

                <div class="mechanism-card">
                    <div class="mechanism-title">
                        <span class="icon">🧠</span>
                        LLM决策机制：llm_client.py - decide_next_step方法
                    </div>
                    
                    <div class="code-section">
                        <div class="code-header">
                            <span>LLM智能决策实现</span>
                            <span class="file-path">agent/llm_client.py</span>
                        </div>
                        <div class="code-content">
<span class="line-number">161</span><span class="keyword">async def</span> <span class="function">decide_next_step</span>(<span class="variable">self</span>, <span class="variable">query</span>: <span class="keyword">str</span>, <span class="variable">execution_history</span>: List[Dict], <span class="variable">remaining_steps</span>: List[Dict]) -> Dict[<span class="keyword">str</span>, Any]:
<span class="line-number">162</span>    <span class="comment"># 构建执行历史信息</span>
<span class="line-number">163</span><span class="highlight-line">    <span class="variable">history_text</span> = <span class="string">"\n"</span>.<span class="function">join</span>([</span>
<span class="line-number">164</span><span class="highlight-line">        <span class="string">f"步骤{i + 1}: {step['function_name']} - {'成功' if step['result']['success'] else '失败'}"</span></span>
<span class="line-number">165</span><span class="highlight-line">        <span class="keyword">for</span> <span class="variable">i</span>, <span class="variable">step</span> <span class="keyword">in</span> <span class="function">enumerate</span>(<span class="variable">execution_history</span>)</span>
<span class="line-number">166</span><span class="highlight-line">    ])</span>
<span class="line-number">167</span>    
<span class="line-number">168</span>    <span class="comment"># 构建剩余步骤信息</span>
<span class="line-number">169</span><span class="highlight-line">    <span class="variable">remaining_text</span> = <span class="string">"\n"</span>.<span class="function">join</span>([</span>
<span class="line-number">170</span><span class="highlight-line">        <span class="string">f"- {step['function_name']}: {step['parameters']}"</span></span>
<span class="line-number">171</span><span class="highlight-line">        <span class="keyword">for</span> <span class="variable">step</span> <span class="keyword">in</span> <span class="variable">remaining_steps</span></span>
<span class="line-number">172</span><span class="highlight-line">    ])</span>
<span class="line-number">173</span>    
<span class="line-number">174</span>    <span class="variable">prompt</span> = <span class="string">f"""
<span class="line-number">175</span>根据执行历史和剩余步骤，决定下一步操作。
<span class="line-number">176</span>
<span class="line-number">177</span>原始查询: {query}
<span class="line-number">178</span>
<span class="line-number">179</span><span class="highlight-line">已执行步骤:
<span class="line-number">180</span>{history_text}</span>
<span class="line-number">181</span>
<span class="line-number">182</span><span class="highlight-line">剩余步骤:
<span class="line-number">183</span>{remaining_text}</span>
<span class="line-number">184</span>
<span class="line-number">185</span>请返回决策：continue/modify/stop
<span class="line-number">186</span>"""</span>
<span class="line-number">187</span>    
<span class="line-number">188</span><span class="highlight-line">    <span class="variable">response</span> = <span class="keyword">await</span> <span class="variable">self</span>.<span class="function">chat_completion</span>([{<span class="string">"role"</span>: <span class="string">"user"</span>, <span class="string">"content"</span>: <span class="variable">prompt</span>}])</span>
<span class="line-number">189</span><span class="highlight-line">    <span class="keyword">return</span> json.<span class="function">loads</span>(<span class="variable">response</span>)</span>
                        </div>
                    </div>
                    
                    <div class="code-explanation">
                        <div class="explanation-title">🔍 智能决策机制</div>
                        <p><strong>第163-166行：</strong>将所有已执行步骤及其结果格式化为文本</p>
                        <p><strong>第169-172行：</strong>将剩余待执行步骤格式化为文本</p>
                        <p><strong>第188行：</strong>LLM基于完整上下文做出智能决策</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 最终结果通信 -->
        <div class="section">
            <div class="section-header">
                <span class="icon">📡</span>
                最后一步如何通信给Agent - 完整结果传递机制
            </div>
            <div class="section-content">
                <div class="mechanism-card">
                    <div class="mechanism-title">
                        <span class="icon">🔄</span>
                        executor.py → core.py 结果传递链路
                    </div>
                    
                    <div class="code-section">
                        <div class="code-header">
                            <span>TaskExecutor返回完整结果</span>
                            <span class="file-path">agent/executor.py</span>
                        </div>
                        <div class="code-content">
<span class="line-number">95</span>    <span class="comment"># 🎉 所有步骤执行完毕，退出while循环</span>
<span class="line-number">96</span>    logger.info(<span class="string">f"🎉 任务计划执行完成！共执行 {len(results)} 个步骤"</span>)
<span class="line-number">97</span>    
<span class="line-number">98</span>    <span class="comment"># 📊 返回所有步骤的执行结果给Agent</span>
<span class="line-number">99</span><span class="highlight-line">    <span class="keyword">return</span> <span class="variable">results</span>  <span class="comment"># List[Dict] 包含所有步骤详细信息</span></span>
<span class="line-number">100</span>
<span class="line-number">101</span>    <span class="comment"># results结构示例：</span>
<span class="line-number">102</span>    <span class="comment"># [</span>
<span class="line-number">103</span>    <span class="comment">#   {</span>
<span class="line-number">104</span>    <span class="comment">#     "step": 1,</span>
<span class="line-number">105</span>    <span class="comment">#     "function_name": "validate_data",</span>
<span class="line-number">106</span>    <span class="comment">#     "parameters": {...},</span>
<span class="line-number">107</span>    <span class="comment">#     "result": {"success": True, "result": {...}},</span>
<span class="line-number">108</span>    <span class="comment">#     "execution_time": 0.51,</span>
<span class="line-number">109</span>    <span class="comment">#     "timestamp": 1748266688.734</span>
<span class="line-number">110</span>    <span class="comment">#   },</span>
<span class="line-number">111</span>    <span class="comment">#   ... 其他步骤</span>
<span class="line-number">112</span>    <span class="comment"># ]</span>
                        </div>
                    </div>
                    
                    <div class="code-section">
                        <div class="code-header">
                            <span>Agent接收并生成最终汇总</span>
                            <span class="file-path">agent/core.py</span>
                        </div>
                        <div class="code-content">
<span class="line-number">52</span>    <span class="comment"># 📥 接收TaskExecutor返回的所有步骤结果</span>
<span class="line-number">53</span><span class="highlight-line">    <span class="variable">results</span> = <span class="keyword">await</span> <span class="variable">self</span>.<span class="variable">executor</span>.<span class="function">execute_with_llm_guidance</span>(<span class="variable">query</span>, <span class="variable">steps</span>)</span>
<span class="line-number">54</span>    
<span class="line-number">55</span>    <span class="comment"># 📊 生成执行总结统计</span>
<span class="line-number">56</span><span class="highlight-line">    <span class="variable">summary</span> = <span class="variable">self</span>.<span class="function">_generate_summary</span>(<span class="variable">query</span>, <span class="variable">steps</span>, <span class="variable">results</span>)</span>
<span class="line-number">57</span>    
<span class="line-number">58</span>    <span class="comment"># 🎯 返回完整的处理结果</span>
<span class="line-number">59</span><span class="highlight-line">    <span class="keyword">return</span> {</span>
<span class="line-number">60</span><span class="highlight-line">        <span class="string">"success"</span>: <span class="keyword">True</span>,</span>
<span class="line-number">61</span><span class="highlight-line">        <span class="string">"query"</span>: <span class="variable">query</span>,              <span class="comment"># 原始用户查询</span></span>
<span class="line-number">62</span><span class="highlight-line">        <span class="string">"steps"</span>: <span class="variable">steps</span>,              <span class="comment"># LLM生成的执行计划</span></span>
<span class="line-number">63</span><span class="highlight-line">        <span class="string">"reasoning"</span>: <span class="variable">reasoning</span>,      <span class="comment"># LLM分析理由</span></span>
<span class="line-number">64</span><span class="highlight-line">        <span class="string">"results"</span>: <span class="variable">results</span>,          <span class="comment"># 所有步骤执行结果</span></span>
<span class="line-number">65</span><span class="highlight-line">        <span class="string">"summary"</span>: <span class="variable">summary</span>           <span class="comment"># 执行统计汇总</span></span>
<span class="line-number">66</span><span class="highlight-line">    }</span>
                        </div>
                    </div>
                    
                    <div class="code-section">
                        <div class="code-header">
                            <span>统计汇总生成逻辑</span>
                            <span class="file-path">agent/core.py</span>
                        </div>
                        <div class="code-content">
<span class="line-number">68</span><span class="keyword">def</span> <span class="function">_generate_summary</span>(<span class="variable">self</span>, <span class="variable">query</span>: <span class="keyword">str</span>, <span class="variable">steps</span>: List[Dict], <span class="variable">results</span>: List[Dict]) -> Dict[<span class="keyword">str</span>, Any]:
<span class="line-number">69</span>    <span class="comment"># 📊 统计成功和失败的步骤</span>
<span class="line-number">70</span><span class="highlight-line">    <span class="variable">successful_steps</span> = [<span class="variable">r</span> <span class="keyword">for</span> <span class="variable">r</span> <span class="keyword">in</span> <span class="variable">results</span> <span class="keyword">if</span> <span class="variable">r</span>[<span class="string">"result"</span>].<span class="function">get</span>(<span class="string">"success"</span>)]</span>
<span class="line-number">71</span><span class="highlight-line">    <span class="variable">failed_steps</span> = [<span class="variable">r</span> <span class="keyword">for</span> <span class="variable">r</span> <span class="keyword">in</span> <span class="variable">results</span> <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable">r</span>[<span class="string">"result"</span>].<span class="function">get</span>(<span class="string">"success"</span>)]</span>
<span class="line-number">72</span>    
<span class="line-number">73</span>    <span class="comment"># ⏱️ 计算总执行时间</span>
<span class="line-number">74</span><span class="highlight-line">    <span class="variable">total_time</span> = <span class="function">sum</span>(<span class="variable">r</span>[<span class="string">"execution_time"</span>] <span class="keyword">for</span> <span class="variable">r</span> <span class="keyword">in</span> <span class="variable">results</span>)</span>
<span class="line-number">75</span>    
<span class="line-number">76</span>    <span class="comment"># 📈 生成详细统计信息</span>
<span class="line-number">77</span><span class="highlight-line">    <span class="variable">summary</span> = {</span>
<span class="line-number">78</span><span class="highlight-line">        <span class="string">"total_planned_steps"</span>: <span class="function">len</span>(<span class="variable">steps</span>),</span>
<span class="line-number">79</span><span class="highlight-line">        <span class="string">"total_executed_steps"</span>: <span class="function">len</span>(<span class="variable">results</span>),</span>
<span class="line-number">80</span><span class="highlight-line">        <span class="string">"successful_steps"</span>: <span class="function">len</span>(<span class="variable">successful_steps</span>),</span>
<span class="line-number">81</span><span class="highlight-line">        <span class="string">"failed_steps"</span>: <span class="function">len</span>(<span class="variable">failed_steps</span>),</span>
<span class="line-number">82</span><span class="highlight-line">        <span class="string">"total_execution_time"</span>: <span class="variable">total_time</span>,</span>
<span class="line-number">83</span><span class="highlight-line">        <span class="string">"average_step_time"</span>: <span class="variable">total_time</span> / <span class="function">len</span>(<span class="variable">results</span>) <span class="keyword">if</span> <span class="variable">results</span> <span class="keyword">else</span> 0,</span>
<span class="line-number">84</span><span class="highlight-line">        <span class="string">"success_rate"</span>: <span class="function">len</span>(<span class="variable">successful_steps</span>) / <span class="function">len</span>(<span class="variable">results</span>) <span class="keyword">if</span> <span class="variable">results</span> <span class="keyword">else</span> 0,</span>
<span class="line-number">85</span><span class="highlight-line">        <span class="string">"status"</span>: <span class="string">"completed"</span> <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable">failed_steps</span> <span class="keyword">else</span> <span class="string">"partial_success"</span></span>
<span class="line-number">86</span><span class="highlight-line">    }</span>
<span class="line-number">87</span>    
<span class="line-number">88</span><span class="highlight-line">    <span class="keyword">return</span> <span class="variable">summary</span></span>
                        </div>
                    </div>
                    
                    <div class="code-explanation">
                        <div class="explanation-title">🔍 结果通信机制详解</div>
                        <p><strong>执行完成信号：</strong>while循环自然结束表示所有步骤完成</p>
                        <p><strong>结果传递：</strong>通过return语句将完整results返回给Agent</p>
                        <p><strong>统计生成：</strong>Agent基于results生成成功率、耗时等统计信息</p>
                        <p><strong>最终输出：</strong>包含原始查询、执行计划、结果、统计的完整数据结构</p>
                    </div>
                </div>

                <div class="flow-diagram">
                    <div class="flow-step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <div class="step-title">最后一步执行完成</div>
                            <div class="step-description">step_result追加到results，remaining_steps.pop(0)后队列为空</div>
                        </div>
                    </div>
                    
                    <div class="flow-step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <div class="step-title">while循环结束</div>
                            <div class="step-description">remaining_steps为空，while条件为False，循环自然结束</div>
                        </div>
                    </div>
                    
                    <div class="flow-step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <div class="step-title">return results</div>
                            <div class="step-description">TaskExecutor将包含所有步骤信息的results返回给Agent</div>
                        </div>
                    </div>
                    
                    <div class="flow-step">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <div class="step-title">Agent生成最终结果</div>
                            <div class="step-description">基于results生成统计汇总，返回完整的处理结果</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 主程序调用链 -->
        <div class="section">
            <div class="section-header">
                <span class="icon">🔗</span>
                完整调用链路：main.py入口点
            </div>
            <div class="section-content">
                <div class="mechanism-card">
                    <div class="mechanism-title">
                        <span class="icon">🚀</span>
                        系统启动与测试流程：main.py
                    </div>
                    
                    <div class="code-section">
                        <div class="code-header">
                            <span>主程序调用流程</span>
                            <span class="file-path">main.py</span>
                        </div>
                        <div class="code-content">
<span class="line-number">6</span><span class="keyword">async def</span> <span class="function">main</span>():
<span class="line-number">7</span>    <span class="comment"># 🚀 步骤1：初始化MCP服务器</span>
<span class="line-number">8</span><span class="highlight-line">    <span class="variable">mcp_server</span> = MCPServer()</span>
<span class="line-number">9</span><span class="highlight-line">    <span class="keyword">await</span> <span class="variable">mcp_server</span>.<span class="function">start</span>()</span>
<span class="line-number">10</span>    
<span class="line-number">11</span>    <span class="comment"># 🤖 步骤2：初始化Agent</span>
<span class="line-number">12</span><span class="highlight-line">    <span class="variable">agent</span> = Agent(<span class="variable">mcp_server</span>)</span>
<span class="line-number">13</span>    
<span class="line-number">14</span>    <span class="comment"># 📋 步骤3：获取并显示可用功能</span>
<span class="line-number">15</span>    <span class="variable">functions</span> = <span class="variable">mcp_server</span>.<span class="function">get_available_functions</span>()
<span class="line-number">16</span>    
<span class="line-number">17</span>    <span class="comment"># 🔍 步骤4：执行测试查询</span>
<span class="line-number">18</span>    <span class="variable">test_queries</span> = [
<span class="line-number">19</span>        <span class="string">"验证用户输入数据，发送HTTP请求获取外部数据，处理合并后插入数据库"</span>,
<span class="line-number">20</span>        <span class="comment"># ... 其他测试查询</span>
<span class="line-number">21</span>    ]
<span class="line-number">22</span>    
<span class="line-number">23</span>    <span class="keyword">for</span> <span class="variable">query</span> <span class="keyword">in</span> <span class="variable">test_queries</span>:
<span class="line-number">24</span>        <span class="comment"># 🎯 关键调用：Agent处理查询</span>
<span class="line-number">25</span><span class="highlight-line">        <span class="variable">result</span> = <span class="keyword">await</span> <span class="variable">agent</span>.<span class="function">process_query</span>(<span class="variable">query</span>)</span>
<span class="line-number">26</span>        
<span class="line-number">27</span>        <span class="comment"># 📊 显示执行结果</span>
<span class="line-number">28</span>        <span class="keyword">if</span> <span class="variable">result</span>[<span class="string">"success"</span>]:
<span class="line-number">29</span><span class="highlight-line">            <span class="variable">summary</span> = <span class="variable">result</span>[<span class="string">"summary"</span>]</span>
<span class="line-number">30</span>            <span class="function">print</span>(<span class="string">f"✅ 成功率: {summary['success_rate']:.1%}"</span>)
<span class="line-number">31</span>            <span class="function">print</span>(<span class="string">f"⏱️ 总耗时: {summary['total_execution_time']:.2f}秒"</span>)
                        </div>
                    </div>
                    
                    <div class="code-explanation">
                        <div class="explanation-title">🔍 完整调用链路</div>
                        <p><strong>main.py → Agent.process_query() → TaskExecutor.execute_with_llm_guidance() → MCP.execute_function()</strong></p>
                        <p>每个环节都有明确的输入输出，形成完整的数据流</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 总结 -->
        <div class="section">
            <div class="section-header">
                <span class="icon">📝</span>
                关键机制总结
            </div>
            <div class="section-content">
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>机制</th>
                                <th>实现文件</th>
                                <th>关键代码</th>
                                <th>作用</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>LLM任务分析</td>
                                <td>llm_client.py</td>
                                <td>analyze_task()第97-123行</td>
                                <td>智能分析用户查询，按优先级生成执行计划</td>
                            </tr>
                            <tr>
                                <td>FIFO队列执行</td>
                                <td>executor.py</td>
                                <td>execute_with_llm_guidance()第20-42行</td>
                                <td>确保步骤严格按顺序执行，不跳过不重复</td>
                            </tr>
                            <tr>
                                <td>步骤完成通知</td>
                                <td>executor.py</td>
                                <td>第41行results.append() + 第42行pop(0)</td>
                                <td>标记步骤完成，触发下一步执行</td>
                            </tr>
                            <tr>
                                <td>LLM智能决策</td>
                                <td>llm_client.py</td>
                                <td>decide_next_step()第161-189行</td>
                                <td>基于执行历史智能调整后续步骤</td>
                            </tr>
                            <tr>
                                <td>结果汇总返回</td>
                                <td>core.py</td>
                                <td>process_query()第53-66行</td>
                                <td>生成完整的执行报告和统计信息</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="mechanism-card">
                    <div class="mechanism-title">
                        <span class="icon">✅</span>
                        系统优势
                    </div>
                    <ul>
                        <li>🧠 <strong>智能任务规划：</strong>LLM根据功能优先级和用户查询生成最优执行计划</li>
                        <li>🔄 <strong>动态执行调整：</strong>每步完成后LLM可根据结果调整后续步骤</li>
                        <li>📋 <strong>严格顺序保证：</strong>FIFO队列机制确保步骤不会跳过或乱序</li>
                        <li>📊 <strong>完整状态跟踪：</strong>详细记录每步执行情况，支持问题诊断</li>
                        <li>🔧 <strong>模块化设计：</strong>各组件职责清晰，易于维护和扩展</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</body>
</html>