2025-05-26 21:35:50,659 - AgentMCP - INFO - 🌟 系统启动开始
2025-05-26 21:35:50,660 - AgentMCP - INFO - 🚀 初始化MCP服务器...
2025-05-26 21:35:50,660 - AgentMCP - INFO - 🚀 初始化MCP服务器
2025-05-26 21:35:50,660 - AgentMCP - INFO - 🔧 初始化功能注册器
2025-05-26 21:35:50,660 - AgentMCP - INFO - 📦 注册功能: process_data - 处理和转换数据格式
2025-05-26 21:35:50,660 - AgentMCP - INFO - 📦 注册功能: validate_data - 验证数据格式和完整性
2025-05-26 21:35:50,660 - AgentMCP - INFO - 📦 注册功能: analyze_data - 分析数据并生成统计信息
2025-05-26 21:35:50,660 - AgentMCP - INFO - 📦 注册功能: read_file - 读取文件内容
2025-05-26 21:35:50,661 - AgentMCP - INFO - 📦 注册功能: write_file - 写入文件内容
2025-05-26 21:35:50,661 - AgentMCP - INFO - 📦 注册功能: http_request - 发送HTTP请求
2025-05-26 21:35:50,661 - AgentMCP - INFO - 📦 注册功能: send_email - 发送电子邮件
2025-05-26 21:35:50,661 - AgentMCP - INFO - 📦 注册功能: database_query - 执行数据库查询
2025-05-26 21:35:50,661 - AgentMCP - INFO - 📦 注册功能: database_insert - 插入数据到数据库
2025-05-26 21:35:50,661 - AgentMCP - INFO - 📦 注册功能: database_update - 更新数据库记录
2025-05-26 21:35:50,661 - AgentMCP - INFO - ✅ 注册功能: process_data
2025-05-26 21:35:50,661 - AgentMCP - INFO - ✅ 注册功能: validate_data
2025-05-26 21:35:50,661 - AgentMCP - INFO - ✅ 注册功能: analyze_data
2025-05-26 21:35:50,661 - AgentMCP - INFO - ✅ 注册功能: read_file
2025-05-26 21:35:50,661 - AgentMCP - INFO - ✅ 注册功能: write_file
2025-05-26 21:35:50,661 - AgentMCP - INFO - ✅ 注册功能: http_request
2025-05-26 21:35:50,661 - AgentMCP - INFO - ✅ 注册功能: send_email
2025-05-26 21:35:50,661 - AgentMCP - INFO - ✅ 注册功能: database_query
2025-05-26 21:35:50,661 - AgentMCP - INFO - ✅ 注册功能: database_insert
2025-05-26 21:35:50,662 - AgentMCP - INFO - ✅ 注册功能: database_update
2025-05-26 21:35:50,662 - AgentMCP - INFO - 📦 功能注册完成，共注册 10 个功能
2025-05-26 21:35:50,662 - AgentMCP - INFO - ✅ MCP服务器启动成功
2025-05-26 21:35:50,662 - AgentMCP - INFO - 🤖 初始化Agent...
2025-05-26 21:35:50,662 - AgentMCP - INFO - 🧠 初始化大模型客户端 - 模型: Qwen3-32B-AWQ
2025-05-26 21:35:50,662 - AgentMCP - INFO - ⚡ 初始化任务执行器
2025-05-26 21:35:50,662 - AgentMCP - INFO - 🤖 Agent初始化完成
2025-05-26 21:35:50,663 - AgentMCP - INFO - 📋 [MCP] 返回可用功能列表，共 10 个功能
2025-05-26 21:35:50,663 - AgentMCP - INFO - 📦 可用功能: process_data - 处理和转换数据格式
2025-05-26 21:35:50,663 - AgentMCP - INFO - 📦 可用功能: validate_data - 验证数据格式和完整性
2025-05-26 21:35:50,663 - AgentMCP - INFO - 📦 可用功能: analyze_data - 分析数据并生成统计信息
2025-05-26 21:35:50,663 - AgentMCP - INFO - 📦 可用功能: read_file - 读取文件内容
2025-05-26 21:35:50,663 - AgentMCP - INFO - 📦 可用功能: write_file - 写入文件内容
2025-05-26 21:35:50,663 - AgentMCP - INFO - 📦 可用功能: http_request - 发送HTTP请求
2025-05-26 21:35:50,664 - AgentMCP - INFO - 📦 可用功能: send_email - 发送电子邮件
2025-05-26 21:35:50,664 - AgentMCP - INFO - 📦 可用功能: database_query - 执行数据库查询
2025-05-26 21:35:50,664 - AgentMCP - INFO - 📦 可用功能: database_insert - 插入数据到数据库
2025-05-26 21:35:50,664 - AgentMCP - INFO - 📦 可用功能: database_update - 更新数据库记录
2025-05-26 21:35:50,664 - AgentMCP - INFO - 🔍 开始测试查询 1: 从数据库查询用户信息，验证数据格式，处理后保存到文件，并发送邮件通知
2025-05-26 21:35:50,664 - AgentMCP - INFO - 🎯 Agent接收到用户查询: 从数据库查询用户信息，验证数据格式，处理后保存到文件，并发送邮件通知
2025-05-26 21:35:50,664 - AgentMCP - INFO - 📋 获取MCP服务器可用功能列表...
2025-05-26 21:35:50,665 - AgentMCP - INFO - 📋 [MCP] 返回可用功能列表，共 10 个功能
2025-05-26 21:35:50,665 - AgentMCP - INFO - 📦 获取到 10 个可用功能
2025-05-26 21:35:50,665 - AgentMCP - INFO -   - process_data: 处理和转换数据格式
2025-05-26 21:35:50,665 - AgentMCP - INFO -   - validate_data: 验证数据格式和完整性
2025-05-26 21:35:50,665 - AgentMCP - INFO -   - analyze_data: 分析数据并生成统计信息
2025-05-26 21:35:50,665 - AgentMCP - INFO -   - read_file: 读取文件内容
2025-05-26 21:35:50,665 - AgentMCP - INFO -   - write_file: 写入文件内容
2025-05-26 21:35:50,665 - AgentMCP - INFO -   - http_request: 发送HTTP请求
2025-05-26 21:35:50,665 - AgentMCP - INFO -   - send_email: 发送电子邮件
2025-05-26 21:35:50,665 - AgentMCP - INFO -   - database_query: 执行数据库查询
2025-05-26 21:35:50,665 - AgentMCP - INFO -   - database_insert: 插入数据到数据库
2025-05-26 21:35:50,666 - AgentMCP - INFO -   - database_update: 更新数据库记录
2025-05-26 21:35:50,666 - AgentMCP - INFO - 🧠 调用大模型进行任务分析...
2025-05-26 21:35:50,666 - AgentMCP - INFO - 🔍 [LLM] 开始任务分析 - 查询: 从数据库查询用户信息，验证数据格式，处理后保存到文件，并发送邮件通知
2025-05-26 21:35:50,666 - AgentMCP - INFO - 🧠 [LLM] 发送任务分析请求
2025-05-26 21:35:50,666 - AgentMCP - INFO - 🌐 [LLM] 发送请求到大模型 - URL: http://192.168.101.214:6007/v1/chat/completions
2025-05-26 21:35:50,666 - AgentMCP - INFO - 📝 [LLM] 请求消息数量: 1
2025-05-26 21:36:14,338 - httpx - INFO - HTTP Request: POST http://192.168.101.214:6007/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-26 21:36:14,340 - AgentMCP - INFO - ✅ [LLM] 大模型响应成功 - 耗时: 23.67秒
2025-05-26 21:36:14,341 - AgentMCP - ERROR - ❌ [LLM] 大模型调用失败: object of type 'NoneType' has no len()
2025-05-26 21:36:14,341 - AgentMCP - INFO - 🔄 [LLM] 使用模拟响应
2025-05-26 21:36:14,342 - AgentMCP - ERROR - ❌ [LLM] 任务分析结果解析失败: Expecting ',' delimiter: line 19 column 9 (char 600)
2025-05-26 21:36:14,342 - AgentMCP - ERROR - 📄 [LLM] 原始响应: 
{
    "steps": [
        {
            "function_name": "validate_data",
            "parameters": {"data": "用户查询参数", "rules": {"min_length": 1}}
        },
        {
            "function_name": "database_query", 
            "parameters": {"sql": "SELECT * FROM users WHERE status='active' LIMIT 10"}
        },
        {
            "function_name": "process_data",
            "parameters": {"data": "数据库查询结果", "operation": "format"}
        },
        {
            "function_name": "write_file",
            "parameters": {"file_path": "output/user_data.txt", "content": "格式化后的用户数据"}}
        }
    ],
    "reasoning": "首先验证输入参数，然后查询数据库获取用户信息，对数据进行格式化处理，最后保存到文件中"
}

2025-05-26 21:36:14,343 - AgentMCP - ERROR - ❌ 大模型无法生成执行计划
2025-05-26 21:36:14,344 - AgentMCP - ERROR - ❌ 查询 1 处理失败: 大模型无法生成执行计划
2025-05-26 21:36:14,344 - AgentMCP - INFO - ⏳ 等待3秒后执行下一个测试...
2025-05-26 21:36:17,356 - AgentMCP - INFO - 🔍 开始测试查询 2: 读取配置文件内容，验证配置项的完整性，然后更新数据库中的系统设置
2025-05-26 21:36:17,357 - AgentMCP - INFO - 🎯 Agent接收到用户查询: 读取配置文件内容，验证配置项的完整性，然后更新数据库中的系统设置
2025-05-26 21:36:17,358 - AgentMCP - INFO - 📋 获取MCP服务器可用功能列表...
2025-05-26 21:36:17,360 - AgentMCP - INFO - 📋 [MCP] 返回可用功能列表，共 10 个功能
2025-05-26 21:36:17,361 - AgentMCP - INFO - 📦 获取到 10 个可用功能
2025-05-26 21:36:17,361 - AgentMCP - INFO -   - process_data: 处理和转换数据格式
2025-05-26 21:36:17,362 - AgentMCP - INFO -   - validate_data: 验证数据格式和完整性
2025-05-26 21:36:17,362 - AgentMCP - INFO -   - analyze_data: 分析数据并生成统计信息
2025-05-26 21:36:17,363 - AgentMCP - INFO -   - read_file: 读取文件内容
2025-05-26 21:36:17,363 - AgentMCP - INFO -   - write_file: 写入文件内容
2025-05-26 21:36:17,364 - AgentMCP - INFO -   - http_request: 发送HTTP请求
2025-05-26 21:36:17,364 - AgentMCP - INFO -   - send_email: 发送电子邮件
2025-05-26 21:36:17,365 - AgentMCP - INFO -   - database_query: 执行数据库查询
2025-05-26 21:36:17,365 - AgentMCP - INFO -   - database_insert: 插入数据到数据库
2025-05-26 21:36:17,365 - AgentMCP - INFO -   - database_update: 更新数据库记录
2025-05-26 21:36:17,365 - AgentMCP - INFO - 🧠 调用大模型进行任务分析...
2025-05-26 21:36:17,366 - AgentMCP - INFO - 🔍 [LLM] 开始任务分析 - 查询: 读取配置文件内容，验证配置项的完整性，然后更新数据库中的系统设置
2025-05-26 21:36:17,366 - AgentMCP - INFO - 🧠 [LLM] 发送任务分析请求
2025-05-26 21:36:17,366 - AgentMCP - INFO - 🌐 [LLM] 发送请求到大模型 - URL: http://192.168.101.214:6007/v1/chat/completions
2025-05-26 21:36:17,366 - AgentMCP - INFO - 📝 [LLM] 请求消息数量: 1
2025-05-26 21:36:34,284 - httpx - INFO - HTTP Request: POST http://192.168.101.214:6007/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-26 21:36:34,286 - AgentMCP - INFO - ✅ [LLM] 大模型响应成功 - 耗时: 16.92秒
2025-05-26 21:36:34,286 - AgentMCP - INFO - 📄 [LLM] 响应长度: 739 字符
2025-05-26 21:36:34,287 - AgentMCP - INFO - ✅ [LLM] 任务分析成功 - 生成 3 个步骤
2025-05-26 21:36:34,288 - AgentMCP - INFO - 💭 [LLM] 分析理由: 根据用户查询，首先需要使用read_file(优先级2)读取配置文件内容，然后通过validate_data(优先级1)验证配置项的完整性，最后使用database_update(优先级5)更新数据库中的系统设置。按照逻辑顺序验证应在读取后执行，数据库更新应在数据验证通过后进行。参数匹配了配置文件路径、必填字段校验规则以及数据库更新语句。
2025-05-26 21:36:34,288 - AgentMCP - INFO - 📋 大模型生成执行计划成功
2025-05-26 21:36:34,289 - AgentMCP - INFO - 📊 计划步骤数: 3
2025-05-26 21:36:34,289 - AgentMCP - INFO - 💭 分析理由: 根据用户查询，首先需要使用read_file(优先级2)读取配置文件内容，然后通过validate_data(优先级1)验证配置项的完整性，最后使用database_update(优先级5)更新数据库中的系统设置。按照逻辑顺序验证应在读取后执行，数据库更新应在数据验证通过后进行。参数匹配了配置文件路径、必填字段校验规则以及数据库更新语句。
2025-05-26 21:36:34,290 - AgentMCP - INFO -   步骤1: read_file - 参数: {'file_path': 'config/system_config.json'}
2025-05-26 21:36:34,290 - AgentMCP - INFO -   步骤2: validate_data - 参数: {'data': '读取的配置文件内容', 'rules': {'required_fields': ['timeout', 'max_connections', 'log_level']}}
2025-05-26 21:36:34,291 - AgentMCP - INFO -   步骤3: database_update - 参数: {'sql': 'UPDATE system_settings SET config = :validated_data WHERE id = 1', 'validated_data': '验证后的配置数据'}
2025-05-26 21:36:34,291 - AgentMCP - INFO - ⚡ 开始执行任务计划...
2025-05-26 21:36:34,291 - AgentMCP - INFO - 🚀 开始执行任务计划
2025-05-26 21:36:34,293 - AgentMCP - INFO - 📋 计划步骤数: 3
2025-05-26 21:36:34,293 - AgentMCP - INFO - 🎯 原始查询: 读取配置文件内容，验证配置项的完整性，然后更新数据库中的系统设置
2025-05-26 21:36:34,294 - AgentMCP - INFO - 📍 执行步骤 1: read_file
2025-05-26 21:36:34,294 - AgentMCP - INFO - ⚡ [执行器] 调用MCP服务器执行功能: read_file
2025-05-26 21:36:34,295 - AgentMCP - INFO - 🎯 [MCP] 接收到功能调用请求 - 功能: read_file
2025-05-26 21:36:34,295 - AgentMCP - INFO - 📝 [MCP] 调用参数: {'file_path': 'config/system_config.json'}
2025-05-26 21:36:34,295 - AgentMCP - INFO - ⚡ [MCP] 开始执行功能: read_file
2025-05-26 21:36:34,295 - AgentMCP - INFO - 📖 [MCP] 开始读取文件 - 路径: config/system_config.json
2025-05-26 21:36:35,101 - AgentMCP - INFO - ℹ️  [MCP] 文件不存在，使用模拟内容
2025-05-26 21:36:35,102 - AgentMCP - INFO - ✅ [MCP] 功能执行完成: read_file
2025-05-26 21:36:35,102 - AgentMCP - INFO - ✅ 步骤 1 执行成功 - 耗时: 0.81秒
2025-05-26 21:36:35,103 - AgentMCP - INFO - 📊 执行结果详情: {'file_path': 'config/system_config.json', 'content': '模拟文件内容 - config/system_config.json\n这是一个测试文件内容\n包含多行数据用于演示', 'size': 56, 'lines': 3}
2025-05-26 21:36:35,104 - AgentMCP - INFO - 🤖 询问大模型关于下一步的决策...
2025-05-26 21:36:35,104 - AgentMCP - INFO - 🤔 [LLM] 开始决策下一步 - 已执行 1 步，剩余 2 步
2025-05-26 21:36:35,105 - AgentMCP - INFO - 🧠 [LLM] 发送决策请求
2025-05-26 21:36:35,105 - AgentMCP - INFO - 🌐 [LLM] 发送请求到大模型 - URL: http://192.168.101.214:6007/v1/chat/completions
2025-05-26 21:36:35,107 - AgentMCP - INFO - 📝 [LLM] 请求消息数量: 1
2025-05-26 21:36:46,159 - httpx - INFO - HTTP Request: POST http://192.168.101.214:6007/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-26 21:36:46,161 - AgentMCP - INFO - ✅ [LLM] 大模型响应成功 - 耗时: 11.05秒
2025-05-26 21:36:46,161 - AgentMCP - INFO - 📄 [LLM] 响应长度: 425 字符
2025-05-26 21:36:46,162 - AgentMCP - ERROR - ❌ [LLM] 决策结果解析失败: Expecting value: line 3 column 1 (char 2)
2025-05-26 21:36:46,162 - AgentMCP - ERROR - 📄 [LLM] 原始响应: 

```json
{
    "action": "continue",
    "next_step": {
        "function_name": "validate_data",
        "parameters": {
            "data": "模拟文件内容 - config/system_config.json\n这是一个测试文件内容\n包含多行数据用于演示",
            "rules": {
                "required_fields": ["timeout", "max_connections", "log_level"]
            }
        }
    },
    "reason": "上一步文件读取成功，继续执行配置项完整性验证。将步骤1获取的配置文件内容作为验证输入，并应用预定义的校验规则检查必要字段是否存在。"
}
```
2025-05-26 21:36:46,163 - AgentMCP - INFO - 🧠 大模型决策: continue - 理由: 解析失败，默认继续执行
2025-05-26 21:36:46,165 - AgentMCP - INFO - ➡️  大模型决定继续执行原计划
2025-05-26 21:36:46,166 - AgentMCP - INFO - ⏳ 等待5秒后执行下一步...
2025-05-26 21:36:51,205 - AgentMCP - INFO - 📍 执行步骤 2: validate_data
2025-05-26 21:36:51,206 - AgentMCP - INFO - ⚡ [执行器] 调用MCP服务器执行功能: validate_data
2025-05-26 21:36:51,207 - AgentMCP - INFO - 🎯 [MCP] 接收到功能调用请求 - 功能: validate_data
2025-05-26 21:36:51,207 - AgentMCP - INFO - 📝 [MCP] 调用参数: {'data': '读取的配置文件内容', 'rules': {'required_fields': ['timeout', 'max_connections', 'log_level']}}
2025-05-26 21:36:51,208 - AgentMCP - INFO - ⚡ [MCP] 开始执行功能: validate_data
2025-05-26 21:36:51,208 - AgentMCP - INFO - 🔍 [MCP] 开始验证数据 - 数据: 读取的配置文件内容, 规则: {'required_fields': ['timeout', 'max_connections', 'log_level']}
2025-05-26 21:36:51,720 - AgentMCP - INFO - ✅ [MCP] 数据验证完成 - 有效性: True
2025-05-26 21:36:51,720 - AgentMCP - INFO - ✅ [MCP] 功能执行完成: validate_data
2025-05-26 21:36:51,721 - AgentMCP - INFO - ✅ 步骤 2 执行成功 - 耗时: 0.52秒
2025-05-26 21:36:51,723 - AgentMCP - INFO - 📊 执行结果详情: {'is_valid': True, 'data': '读取的配置文件内容', 'validation_rules': {'required_fields': ['timeout', 'max_connections', 'log_level']}, 'validation_message': '数据有效'}
2025-05-26 21:36:51,724 - AgentMCP - INFO - 🤖 询问大模型关于下一步的决策...
2025-05-26 21:36:51,725 - AgentMCP - INFO - 🤔 [LLM] 开始决策下一步 - 已执行 2 步，剩余 1 步
2025-05-26 21:36:51,725 - AgentMCP - INFO - 🧠 [LLM] 发送决策请求
2025-05-26 21:36:51,726 - AgentMCP - INFO - 🌐 [LLM] 发送请求到大模型 - URL: http://192.168.101.214:6007/v1/chat/completions
2025-05-26 21:36:51,726 - AgentMCP - INFO - 📝 [LLM] 请求消息数量: 1
2025-05-26 21:37:00,098 - httpx - INFO - HTTP Request: POST http://192.168.101.214:6007/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-26 21:37:00,100 - AgentMCP - INFO - ✅ [LLM] 大模型响应成功 - 耗时: 8.37秒
2025-05-26 21:37:00,101 - AgentMCP - INFO - 📄 [LLM] 响应长度: 326 字符
2025-05-26 21:37:00,101 - AgentMCP - INFO - ✅ [LLM] 决策完成 - 动作: continue
2025-05-26 21:37:00,102 - AgentMCP - INFO - 💭 [LLM] 决策理由: 配置文件读取和验证步骤均成功完成，应继续执行数据库更新操作，并使用已验证的配置数据作为参数
2025-05-26 21:37:00,102 - AgentMCP - INFO - 🧠 大模型决策: continue - 理由: 配置文件读取和验证步骤均成功完成，应继续执行数据库更新操作，并使用已验证的配置数据作为参数
2025-05-26 21:37:00,103 - AgentMCP - INFO - ➡️  大模型决定继续执行原计划
2025-05-26 21:37:00,104 - AgentMCP - INFO - ⏳ 等待5秒后执行下一步...
2025-05-26 21:37:05,146 - AgentMCP - INFO - 📍 执行步骤 3: database_update
2025-05-26 21:37:05,146 - AgentMCP - INFO - ⚡ [执行器] 调用MCP服务器执行功能: database_update
2025-05-26 21:37:05,146 - AgentMCP - INFO - 🎯 [MCP] 接收到功能调用请求 - 功能: database_update
2025-05-26 21:37:05,146 - AgentMCP - INFO - 📝 [MCP] 调用参数: {'sql': 'UPDATE system_settings SET config = :validated_data WHERE id = 1', 'validated_data': '验证后的配置数据'}
2025-05-26 21:37:05,146 - AgentMCP - INFO - ⚡ [MCP] 开始执行功能: database_update
2025-05-26 21:37:05,147 - AgentMCP - ERROR - ❌ [MCP] 功能执行异常: DatabaseUpdateFunction.execute() got an unexpected keyword argument 'sql'
2025-05-26 21:37:05,147 - AgentMCP - ERROR - ❌ 步骤 3 执行失败: 功能执行异常: DatabaseUpdateFunction.execute() got an unexpected keyword argument 'sql'
2025-05-26 21:37:05,147 - AgentMCP - INFO - 🎉 任务计划执行完成！共执行 3 个步骤
2025-05-26 21:37:05,147 - AgentMCP - INFO - 📈 执行统计: 计划3步, 执行3步, 成功2步, 失败1步
2025-05-26 21:37:05,147 - AgentMCP - INFO - ⏱️  总耗时: 1.33秒, 平均每步: 0.44秒
2025-05-26 21:37:05,147 - AgentMCP - INFO - 📊 成功率: 66.7%
2025-05-26 21:37:05,147 - AgentMCP - INFO - 📊 生成执行总结: {'total_planned_steps': 3, 'total_executed_steps': 3, 'successful_steps': 2, 'failed_steps': 1, 'total_execution_time': 1.325202226638794, 'average_step_time': 0.44173407554626465, 'success_rate': 0.6666666666666666, 'status': 'partial_success'}
2025-05-26 21:37:05,147 - AgentMCP - INFO - ✅ 查询 2 处理成功
2025-05-26 21:37:05,148 - AgentMCP - INFO - 📊 查询 2 总结: {'total_planned_steps': 3, 'total_executed_steps': 3, 'successful_steps': 2, 'failed_steps': 1, 'total_execution_time': 1.325202226638794, 'average_step_time': 0.44173407554626465, 'success_rate': 0.6666666666666666, 'status': 'partial_success'}
2025-05-26 21:37:05,148 - AgentMCP - INFO - ⏳ 等待3秒后执行下一个测试...
2025-05-26 21:37:08,152 - AgentMCP - INFO - 🔍 开始测试查询 3: 查询数据库中的订单数据，进行数据分析生成统计报告，保存结果并发送邮件
2025-05-26 21:37:08,153 - AgentMCP - INFO - 🎯 Agent接收到用户查询: 查询数据库中的订单数据，进行数据分析生成统计报告，保存结果并发送邮件
2025-05-26 21:37:08,154 - AgentMCP - INFO - 📋 获取MCP服务器可用功能列表...
2025-05-26 21:37:08,155 - AgentMCP - INFO - 📋 [MCP] 返回可用功能列表，共 10 个功能
2025-05-26 21:37:08,155 - AgentMCP - INFO - 📦 获取到 10 个可用功能
2025-05-26 21:37:08,157 - AgentMCP - INFO -   - process_data: 处理和转换数据格式
2025-05-26 21:37:08,157 - AgentMCP - INFO -   - validate_data: 验证数据格式和完整性
2025-05-26 21:37:08,158 - AgentMCP - INFO -   - analyze_data: 分析数据并生成统计信息
2025-05-26 21:37:08,158 - AgentMCP - INFO -   - read_file: 读取文件内容
2025-05-26 21:37:08,159 - AgentMCP - INFO -   - write_file: 写入文件内容
2025-05-26 21:37:08,159 - AgentMCP - INFO -   - http_request: 发送HTTP请求
2025-05-26 21:37:08,160 - AgentMCP - INFO -   - send_email: 发送电子邮件
2025-05-26 21:37:08,160 - AgentMCP - INFO -   - database_query: 执行数据库查询
2025-05-26 21:37:08,160 - AgentMCP - INFO -   - database_insert: 插入数据到数据库
2025-05-26 21:37:08,161 - AgentMCP - INFO -   - database_update: 更新数据库记录
2025-05-26 21:37:08,161 - AgentMCP - INFO - 🧠 调用大模型进行任务分析...
2025-05-26 21:37:08,162 - AgentMCP - INFO - 🔍 [LLM] 开始任务分析 - 查询: 查询数据库中的订单数据，进行数据分析生成统计报告，保存结果并发送邮件
2025-05-26 21:37:08,162 - AgentMCP - INFO - 🧠 [LLM] 发送任务分析请求
2025-05-26 21:37:08,162 - AgentMCP - INFO - 🌐 [LLM] 发送请求到大模型 - URL: http://192.168.101.214:6007/v1/chat/completions
2025-05-26 21:37:08,162 - AgentMCP - INFO - 📝 [LLM] 请求消息数量: 1
2025-05-26 21:37:31,281 - httpx - INFO - HTTP Request: POST http://192.168.101.214:6007/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-26 21:37:31,282 - AgentMCP - INFO - ✅ [LLM] 大模型响应成功 - 耗时: 23.12秒
2025-05-26 21:37:31,283 - AgentMCP - INFO - 📄 [LLM] 响应长度: 1268 字符
2025-05-26 21:37:31,283 - AgentMCP - ERROR - ❌ [LLM] 任务分析结果解析失败: Unterminated string starting at: line 43 column 18 (char 1193)
2025-05-26 21:37:31,283 - AgentMCP - ERROR - 📄 [LLM] 原始响应: 

{
    "steps": [
        {
            "function_name": "database_query",
            "parameters": {
                "sql": "SELECT * FROM orders WHERE status = 'completed'"
            }
        },
        {
            "function_name": "process_data",
            "parameters": {
                "data": "查询结果",
                "operation": "convert_currency",
                "target_currency": "USD"
            }
        },
        {
            "function_name": "analyze_data",
            "parameters": {
                "data": "处理后的数据",
                "metrics": ["total_sales", "average_order_value", "order_trend"]
            }
        },
        {
            "function_name": "write_file",
            "parameters": {
                "file_path": "reports/order_statistics_report.txt",
                "content": "生成的统计报告"
            }
        },
        {
            "function_name": "send_email",
            "parameters": {
                "to": "manager@example.com",
                "subject": "月度订单统计报告",
                "body": "请查收附件中的订单统计报告",
                "attachment_path": "reports/order_statistics_report.txt"
            }
        }
    ],
    "reasoning": "根据用户需求，首先通过database_query(优先级2)获取订单数据，使用process_data(优先级3)转换货币格式，调用analyze
2025-05-26 21:37:31,284 - AgentMCP - ERROR - ❌ 大模型无法生成执行计划
2025-05-26 21:37:31,284 - AgentMCP - ERROR - ❌ 查询 3 处理失败: 大模型无法生成执行计划
2025-05-26 21:37:31,285 - AgentMCP - INFO - ⏳ 等待3秒后执行下一个测试...
2025-05-26 21:37:34,289 - AgentMCP - INFO - 🔍 开始测试查询 4: 验证用户输入数据，发送HTTP请求获取外部数据，处理合并后插入数据库
2025-05-26 21:37:34,290 - AgentMCP - INFO - 🎯 Agent接收到用户查询: 验证用户输入数据，发送HTTP请求获取外部数据，处理合并后插入数据库
2025-05-26 21:37:34,290 - AgentMCP - INFO - 📋 获取MCP服务器可用功能列表...
2025-05-26 21:37:34,291 - AgentMCP - INFO - 📋 [MCP] 返回可用功能列表，共 10 个功能
2025-05-26 21:37:34,291 - AgentMCP - INFO - 📦 获取到 10 个可用功能
2025-05-26 21:37:34,291 - AgentMCP - INFO -   - process_data: 处理和转换数据格式
2025-05-26 21:37:34,291 - AgentMCP - INFO -   - validate_data: 验证数据格式和完整性
2025-05-26 21:37:34,291 - AgentMCP - INFO -   - analyze_data: 分析数据并生成统计信息
2025-05-26 21:37:34,292 - AgentMCP - INFO -   - read_file: 读取文件内容
2025-05-26 21:37:34,292 - AgentMCP - INFO -   - write_file: 写入文件内容
2025-05-26 21:37:34,292 - AgentMCP - INFO -   - http_request: 发送HTTP请求
2025-05-26 21:37:34,292 - AgentMCP - INFO -   - send_email: 发送电子邮件
2025-05-26 21:37:34,292 - AgentMCP - INFO -   - database_query: 执行数据库查询
2025-05-26 21:37:34,293 - AgentMCP - INFO -   - database_insert: 插入数据到数据库
2025-05-26 21:37:34,293 - AgentMCP - INFO -   - database_update: 更新数据库记录
2025-05-26 21:37:34,293 - AgentMCP - INFO - 🧠 调用大模型进行任务分析...
2025-05-26 21:37:34,293 - AgentMCP - INFO - 🔍 [LLM] 开始任务分析 - 查询: 验证用户输入数据，发送HTTP请求获取外部数据，处理合并后插入数据库
2025-05-26 21:37:34,294 - AgentMCP - INFO - 🧠 [LLM] 发送任务分析请求
2025-05-26 21:37:34,294 - AgentMCP - INFO - 🌐 [LLM] 发送请求到大模型 - URL: http://192.168.101.214:6007/v1/chat/completions
2025-05-26 21:37:34,294 - AgentMCP - INFO - 📝 [LLM] 请求消息数量: 1
2025-05-26 21:37:48,214 - httpx - INFO - HTTP Request: POST http://192.168.101.214:6007/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-26 21:37:48,215 - AgentMCP - INFO - ✅ [LLM] 大模型响应成功 - 耗时: 13.92秒
2025-05-26 21:37:48,215 - AgentMCP - INFO - 📄 [LLM] 响应长度: 816 字符
2025-05-26 21:37:48,217 - AgentMCP - INFO - ✅ [LLM] 任务分析成功 - 生成 4 个步骤
2025-05-26 21:37:48,218 - AgentMCP - INFO - 💭 [LLM] 分析理由: 根据用户查询，首先使用优先级最高的validate_data验证输入数据完整性。接着通过http_request获取外部数据，使用process_data将验证后的数据与外部数据合并，最后通过database_insert将处理后的数据存入数据库。优先级排序符合验证(1)<读取/请求(2/3)<处理(3)<写入(5)的逻辑顺序。
2025-05-26 21:37:48,218 - AgentMCP - INFO - 📋 大模型生成执行计划成功
2025-05-26 21:37:48,219 - AgentMCP - INFO - 📊 计划步骤数: 4
2025-05-26 21:37:48,219 - AgentMCP - INFO - 💭 分析理由: 根据用户查询，首先使用优先级最高的validate_data验证输入数据完整性。接着通过http_request获取外部数据，使用process_data将验证后的数据与外部数据合并，最后通过database_insert将处理后的数据存入数据库。优先级排序符合验证(1)<读取/请求(2/3)<处理(3)<写入(5)的逻辑顺序。
2025-05-26 21:37:48,220 - AgentMCP - INFO -   步骤1: validate_data - 参数: {'data': '用户输入数据', 'rules': {'required_fields': ['id', 'name']}}
2025-05-26 21:37:48,220 - AgentMCP - INFO -   步骤2: http_request - 参数: {'url': 'https://api.example.com/data', 'method': 'GET'}
2025-05-26 21:37:48,220 - AgentMCP - INFO -   步骤3: process_data - 参数: {'data1': '验证后的用户输入数据', 'data2': 'HTTP请求结果', 'operation': 'merge'}
2025-05-26 21:37:48,221 - AgentMCP - INFO -   步骤4: database_insert - 参数: {'table': 'user_data', 'data': '处理后的合并数据'}
2025-05-26 21:37:48,221 - AgentMCP - INFO - ⚡ 开始执行任务计划...
2025-05-26 21:37:48,221 - AgentMCP - INFO - 🚀 开始执行任务计划
2025-05-26 21:37:48,222 - AgentMCP - INFO - 📋 计划步骤数: 4
2025-05-26 21:37:48,222 - AgentMCP - INFO - 🎯 原始查询: 验证用户输入数据，发送HTTP请求获取外部数据，处理合并后插入数据库
2025-05-26 21:37:48,222 - AgentMCP - INFO - 📍 执行步骤 1: validate_data
2025-05-26 21:37:48,224 - AgentMCP - INFO - ⚡ [执行器] 调用MCP服务器执行功能: validate_data
2025-05-26 21:37:48,224 - AgentMCP - INFO - 🎯 [MCP] 接收到功能调用请求 - 功能: validate_data
2025-05-26 21:37:48,224 - AgentMCP - INFO - 📝 [MCP] 调用参数: {'data': '用户输入数据', 'rules': {'required_fields': ['id', 'name']}}
2025-05-26 21:37:48,224 - AgentMCP - INFO - ⚡ [MCP] 开始执行功能: validate_data
2025-05-26 21:37:48,224 - AgentMCP - INFO - 🔍 [MCP] 开始验证数据 - 数据: 用户输入数据, 规则: {'required_fields': ['id', 'name']}
2025-05-26 21:37:48,734 - AgentMCP - INFO - ✅ [MCP] 数据验证完成 - 有效性: True
2025-05-26 21:37:48,734 - AgentMCP - INFO - ✅ [MCP] 功能执行完成: validate_data
2025-05-26 21:37:48,736 - AgentMCP - INFO - ✅ 步骤 1 执行成功 - 耗时: 0.51秒
2025-05-26 21:37:48,737 - AgentMCP - INFO - 📊 执行结果详情: {'is_valid': True, 'data': '用户输入数据', 'validation_rules': {'required_fields': ['id', 'name']}, 'validation_message': '数据有效'}
2025-05-26 21:37:48,737 - AgentMCP - INFO - 🤖 询问大模型关于下一步的决策...
2025-05-26 21:37:48,738 - AgentMCP - INFO - 🤔 [LLM] 开始决策下一步 - 已执行 1 步，剩余 3 步
2025-05-26 21:37:48,739 - AgentMCP - INFO - 🧠 [LLM] 发送决策请求
2025-05-26 21:37:48,739 - AgentMCP - INFO - 🌐 [LLM] 发送请求到大模型 - URL: http://192.168.101.214:6007/v1/chat/completions
2025-05-26 21:37:48,740 - AgentMCP - INFO - 📝 [LLM] 请求消息数量: 1
2025-05-26 21:37:58,318 - httpx - INFO - HTTP Request: POST http://192.168.101.214:6007/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-26 21:37:58,320 - AgentMCP - INFO - ✅ [LLM] 大模型响应成功 - 耗时: 9.58秒
2025-05-26 21:37:58,321 - AgentMCP - INFO - 📄 [LLM] 响应长度: 277 字符
2025-05-26 21:37:58,321 - AgentMCP - INFO - ✅ [LLM] 决策完成 - 动作: continue
2025-05-26 21:37:58,322 - AgentMCP - INFO - 💭 [LLM] 决策理由: 上一步数据验证成功，继续执行HTTP请求步骤。根据流程需要先获取外部数据才能进行后续的数据合并操作
2025-05-26 21:37:58,322 - AgentMCP - INFO - 🧠 大模型决策: continue - 理由: 上一步数据验证成功，继续执行HTTP请求步骤。根据流程需要先获取外部数据才能进行后续的数据合并操作
2025-05-26 21:37:58,322 - AgentMCP - INFO - ➡️  大模型决定继续执行原计划
2025-05-26 21:37:58,323 - AgentMCP - INFO - ⏳ 等待5秒后执行下一步...
2025-05-26 21:38:03,368 - AgentMCP - INFO - 📍 执行步骤 2: http_request
2025-05-26 21:38:03,368 - AgentMCP - INFO - ⚡ [执行器] 调用MCP服务器执行功能: http_request
2025-05-26 21:38:03,369 - AgentMCP - INFO - 🎯 [MCP] 接收到功能调用请求 - 功能: http_request
2025-05-26 21:38:03,369 - AgentMCP - INFO - 📝 [MCP] 调用参数: {'url': 'https://api.example.com/data', 'method': 'GET'}
2025-05-26 21:38:03,369 - AgentMCP - INFO - ⚡ [MCP] 开始执行功能: http_request
2025-05-26 21:38:03,369 - AgentMCP - INFO - 🌐 [MCP] 开始HTTP请求 - URL: https://api.example.com/data, 方法: GET
2025-05-26 21:38:05,373 - AgentMCP - INFO - ✅ [MCP] HTTP请求完成 - 状态码: 200, 响应大小: 261 字符
2025-05-26 21:38:05,373 - AgentMCP - INFO - ✅ [MCP] 功能执行完成: http_request
2025-05-26 21:38:05,373 - AgentMCP - INFO - ✅ 步骤 2 执行成功 - 耗时: 2.00秒
2025-05-26 21:38:05,374 - AgentMCP - INFO - 📊 执行结果详情: {'url': 'https://api.example.com/data', 'method': 'GET', 'status_code': 200, 'response_data': {'message': '模拟响应来自 https://api.example.com/data', 'timestamp': 1748266685.3732271, 'data': {}, 'headers': {'Content-Type': 'application/json'}}, 'request_data': None}
2025-05-26 21:38:05,374 - AgentMCP - INFO - 🤖 询问大模型关于下一步的决策...
2025-05-26 21:38:05,375 - AgentMCP - INFO - 🤔 [LLM] 开始决策下一步 - 已执行 2 步，剩余 2 步
2025-05-26 21:38:05,375 - AgentMCP - INFO - 🧠 [LLM] 发送决策请求
2025-05-26 21:38:05,375 - AgentMCP - INFO - 🌐 [LLM] 发送请求到大模型 - URL: http://192.168.101.214:6007/v1/chat/completions
2025-05-26 21:38:05,376 - AgentMCP - INFO - 📝 [LLM] 请求消息数量: 1
2025-05-26 21:38:16,707 - httpx - INFO - HTTP Request: POST http://192.168.101.214:6007/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-26 21:38:16,708 - AgentMCP - INFO - ✅ [LLM] 大模型响应成功 - 耗时: 11.33秒
2025-05-26 21:38:16,708 - AgentMCP - INFO - 📄 [LLM] 响应长度: 444 字符
2025-05-26 21:38:16,708 - AgentMCP - INFO - ✅ [LLM] 决策完成 - 动作: continue
2025-05-26 21:38:16,709 - AgentMCP - INFO - 💭 [LLM] 决策理由: 前序步骤验证和HTTP请求均成功完成，需按剩余步骤执行数据合并操作。参数data1取自验证后的用户数据（含必要字段id/name），data2使用HTTP响应原始数据进行合并
2025-05-26 21:38:16,709 - AgentMCP - INFO - 🧠 大模型决策: continue - 理由: 前序步骤验证和HTTP请求均成功完成，需按剩余步骤执行数据合并操作。参数data1取自验证后的用户数据（含必要字段id/name），data2使用HTTP响应原始数据进行合并
2025-05-26 21:38:16,709 - AgentMCP - INFO - ➡️  大模型决定继续执行原计划
2025-05-26 21:38:16,709 - AgentMCP - INFO - ⏳ 等待5秒后执行下一步...
2025-05-26 21:38:21,753 - AgentMCP - INFO - 📍 执行步骤 3: process_data
2025-05-26 21:38:21,754 - AgentMCP - INFO - ⚡ [执行器] 调用MCP服务器执行功能: process_data
2025-05-26 21:38:21,754 - AgentMCP - INFO - 🎯 [MCP] 接收到功能调用请求 - 功能: process_data
2025-05-26 21:38:21,754 - AgentMCP - INFO - 📝 [MCP] 调用参数: {'data1': '验证后的用户输入数据', 'data2': 'HTTP请求结果', 'operation': 'merge'}
2025-05-26 21:38:21,756 - AgentMCP - INFO - ⚡ [MCP] 开始执行功能: process_data
2025-05-26 21:38:21,756 - AgentMCP - ERROR - ❌ [MCP] 功能执行异常: DataProcessFunction.execute() got an unexpected keyword argument 'data1'
2025-05-26 21:38:21,756 - AgentMCP - ERROR - ❌ 步骤 3 执行失败: 功能执行异常: DataProcessFunction.execute() got an unexpected keyword argument 'data1'
2025-05-26 21:38:21,756 - AgentMCP - INFO - 🤖 询问大模型关于下一步的决策...
2025-05-26 21:38:21,757 - AgentMCP - INFO - 🤔 [LLM] 开始决策下一步 - 已执行 3 步，剩余 1 步
2025-05-26 21:38:21,757 - AgentMCP - INFO - 🧠 [LLM] 发送决策请求
2025-05-26 21:38:21,757 - AgentMCP - INFO - 🌐 [LLM] 发送请求到大模型 - URL: http://192.168.101.214:6007/v1/chat/completions
2025-05-26 21:38:21,757 - AgentMCP - INFO - 📝 [LLM] 请求消息数量: 1
2025-05-26 21:38:37,182 - httpx - INFO - HTTP Request: POST http://192.168.101.214:6007/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-26 21:38:37,184 - AgentMCP - INFO - ✅ [LLM] 大模型响应成功 - 耗时: 15.43秒
2025-05-26 21:38:37,185 - AgentMCP - INFO - 📄 [LLM] 响应长度: 533 字符
2025-05-26 21:38:37,186 - AgentMCP - INFO - ✅ [LLM] 决策完成 - 动作: modify
2025-05-26 21:38:37,186 - AgentMCP - INFO - 💭 [LLM] 决策理由: process_data步骤因参数错误失败，需要修正参数结构。将用户输入数据和API响应数据作为input_data参数传入，避免使用错误的'data1'参数名，确保参数结构与函数定义匹配后重新执行
2025-05-26 21:38:37,186 - AgentMCP - INFO - 🧠 大模型决策: modify - 理由: process_data步骤因参数错误失败，需要修正参数结构。将用户输入数据和API响应数据作为input_data参数传入，避免使用错误的'data1'参数名，确保参数结构与函数定义匹配后重新执行
2025-05-26 21:38:37,187 - AgentMCP - INFO - 🔄 大模型修改了下一步执行计划
2025-05-26 21:38:37,187 - AgentMCP - INFO - 📝 原计划: {'function_name': 'database_insert', 'parameters': {'table': 'user_data', 'data': '处理后的合并数据'}}
2025-05-26 21:38:37,189 - AgentMCP - INFO - 📝 新计划: {'function_name': 'process_data', 'parameters': {'input_data': {'user_data': '用户输入数据', 'api_response': {'message': '模拟响应来自 https://api.example.com/data', 'timestamp': 1748266685.3732271, 'data': {}}}}}
2025-05-26 21:38:37,189 - AgentMCP - INFO - ⏳ 等待5秒后执行下一步...
2025-05-26 21:38:42,239 - AgentMCP - INFO - 📍 执行步骤 4: process_data
2025-05-26 21:38:42,240 - AgentMCP - INFO - ⚡ [执行器] 调用MCP服务器执行功能: process_data
2025-05-26 21:38:42,240 - AgentMCP - INFO - 🎯 [MCP] 接收到功能调用请求 - 功能: process_data
2025-05-26 21:38:42,241 - AgentMCP - INFO - 📝 [MCP] 调用参数: {'input_data': {'user_data': '用户输入数据', 'api_response': {'message': '模拟响应来自 https://api.example.com/data', 'timestamp': 1748266685.3732271, 'data': {}}}}
2025-05-26 21:38:42,241 - AgentMCP - INFO - ⚡ [MCP] 开始执行功能: process_data
2025-05-26 21:38:42,241 - AgentMCP - ERROR - ❌ [MCP] 功能执行异常: DataProcessFunction.execute() got an unexpected keyword argument 'input_data'
2025-05-26 21:38:42,242 - AgentMCP - ERROR - ❌ 步骤 4 执行失败: 功能执行异常: DataProcessFunction.execute() got an unexpected keyword argument 'input_data'
2025-05-26 21:38:42,242 - AgentMCP - INFO - 🎉 任务计划执行完成！共执行 4 个步骤
2025-05-26 21:38:42,243 - AgentMCP - INFO - 📈 执行统计: 计划4步, 执行4步, 成功2步, 失败2步
2025-05-26 21:38:42,243 - AgentMCP - INFO - ⏱️  总耗时: 2.52秒, 平均每步: 0.63秒
2025-05-26 21:38:42,243 - AgentMCP - INFO - 📊 成功率: 50.0%
2025-05-26 21:38:42,243 - AgentMCP - INFO - 📊 生成执行总结: {'total_planned_steps': 4, 'total_executed_steps': 4, 'successful_steps': 2, 'failed_steps': 2, 'total_execution_time': 2.5197975635528564, 'average_step_time': 0.6299493908882141, 'success_rate': 0.5, 'status': 'partial_success'}
2025-05-26 21:38:42,244 - AgentMCP - INFO - ✅ 查询 4 处理成功
2025-05-26 21:38:42,245 - AgentMCP - INFO - 📊 查询 4 总结: {'total_planned_steps': 4, 'total_executed_steps': 4, 'successful_steps': 2, 'failed_steps': 2, 'total_execution_time': 2.5197975635528564, 'average_step_time': 0.6299493908882141, 'success_rate': 0.5, 'status': 'partial_success'}
2025-05-26 21:38:42,245 - AgentMCP - INFO - 🛑 系统关闭...
2025-05-26 21:38:42,245 - AgentMCP - INFO - 🛑 MCP服务器已停止
2025-05-26 21:38:42,245 - AgentMCP - INFO - ✅ 系统已完全关闭
